# VisionGuard — كشف التهديدات الآلي للمراقبة الآمنة

**VisionGuard** هو نظام أمان مسؤول للرؤية الحاسوبية يكتشف التهديدات المحتملة (الأسلحة، والأقنعة/أغطية الوجه المستخدمة للتخفي، والسلوك العنيف/القتالي)، ويلتقط مقاطع قصيرة كدليل، ويطبق إجراءات الحفاظ على الخصوصية (تشويش الوجوه)، ويخزن الأدلة مشفرة، ويعرض تنبيهات قابلة للمراجعة البشرية على لوحة التحكم. النظام مصمم بشكل صريح **عدم** أداء التعريف البيومتري أو التتبع المستمر للأفراد — بدلاً من ذلك يركز على الكشف الآلي الآمن + التحقق البشري وتصعيد الحوادث.

---

## جدول المحتويات

1. [نظرة عامة على المشروع](#نظرة-عامة-على-المشروع)
2. [الميزات الرئيسية](#الميزات-الرئيسية)
3. [الهندسة المعمارية](#الهندسة-المعمارية)
4. [المجموعة التقنية](#المجموعة-التقنية)
5. [البداية السريعة — الإعداد المحلي (للمطورين)](#البداية-السريعة--الإعداد-المحلي-للمطورين)
6. [التكوين / متغيرات البيئة](#التكوين--متغيرات-البيئة)
7. [أمثلة الاستخدام](#أمثلة-الاستخدام)
8. [تخزين البيانات والخصوصية](#تخزين-البيانات-والخصوصية)
9. [التقييم والمقاييس](#التقييم-والمقاييس)
10. [النشر](#النشر)
11. [المساهمة](#المساهمة)
12. [إشعار قانوني وأخلاقي](#إشعار-قانوني-وأخلاقي)
13. [الترخيص والاتصال](#الترخيص-والاتصال)

---

## نظرة عامة على المشروع

يعالج VisionGuard البث المباشر للفيديو (كاميرات RTSP/IP أو الفيديو المسجل) ويشغل نماذج خفيفة الوزن لكشف الكائنات وتمييز الأفعال لتحديد حوادث الأمان المحتملة (سلاح مرئي، قناع/غطاء مشبوه، أو أفعال عنيفة). عند اكتشاف حادث محتمل:

- يجب تأكيد الكشف عبر إطارات متعددة لتقليل الإيجابيات الخاطئة.
- يلتقط النظام مقطعاً قصيراً ولقطات صور.
- تتم معالجة جميع الملفات المحفوظة بتشويش الوجوه افتراضياً.
- ملفات الأدلة مشفرة أثناء التخزين.
- ينشئ النظام تنبيهاً في لوحة تحكم ويب للمراجعة البشرية.
- إذا أكد المشغل، يمكن للنظام إشعار جهة الاتصال الأمنية المكونة (SMS / بريد إلكتروني / webhook).

VisionGuard مخصص للحالات التي تحتاج إنذار آلي مبكر مع الحفاظ على الخصوصية والامتثال للوائح.

---

## الميزات الرئيسية

- كشف الكائنات في الوقت الفعلي (الأسلحة، الأقنعة) وتمييز الأفعال البسيط (القتال/الحركة العنيفة).
- التنعيم الزمني — تتطلب الاكتشافات التأكيد عبر عدة إطارات.
- التقاط الأدلة: مقاطع فيديو قصيرة مشفرة + لقطات مشوشة.
- سير عمل الإنسان في الحلقة: يراجع المشغل التنبيهات قبل التصعيد.
- سجلات التدقيق والتحكم في الوصول (RBAC).
- سياسة احتفاظ قابلة للتكوين وتشفير التخزين.
- هندسة معيارية — سهولة تبديل أو ضبط النماذج.

---

## الهندسة المعمارية

```
[الكاميرات / ملفات الفيديو] --> [مُلتقط الإطارات] --> [الكاشف (YOLO)] --> [المرشح الزمني / تمييز الأفعال]
        --> [معالج الأدلة (تشويش الوجه + تشفير)] --> [التخزين (مخزن كائنات + قاعدة البيانات)]
        --> [طابور التنبيهات] --> [لوحة التحكم (المراجعة البشرية)]
        --> [عند التأكيد] --> [خدمة الإشعارات (بريد إلكتروني/SMS/webhook)]
```

---

## المجموعة التقنية (مقترحة)

- الرؤية الحاسوبية / الكشف: Python، OpenCV، PyTorch، Ultralytics YOLO (v8) أو مكافئ
- الوضعية / الأفعال: MediaPipe أو 3D-CNN / TSN خفيف الوزن
- الخلفية: FastAPI أو Flask
- الواجهة الأمامية: React / Next.js
- التخزين: PostgreSQL (البيانات الوصفية)، مخزن كائنات متوافق مع S3 (مقاطع مشفرة)
- الطابور (اختياري): Redis / RabbitMQ
- عتاد الحافة (اختياري): NVIDIA Jetson / Intel NCS2
- الحاويات: Docker و docker-compose

---

## البداية السريعة — الإعداد المحلي (للمطورين)

> خطوات التطوير المحلي الأدنى — اضبط القيم للإنتاج.

1. استنساخ المستودع:

```bash
git clone https://github.com/your-org/visionguard.git
cd visionguard
```

2. إنشاء وتفعيل بيئة Python الافتراضية:

```bash
python -m venv .venv
# Linux / macOS
source .venv/bin/activate
# Windows (PowerShell)
.venv\Scripts\Activate.ps1
```

3. تثبيت التبعيات:

```bash
pip install -r requirements.txt
# مثال على التبعيات: opencv-python, ultralytics, fastapi, uvicorn, cryptography, sqlalchemy, boto3
```

4. نسخ ملف البيئة المثال وتحريره:

```bash
cp .env.example .env
# حرر .env لتكوين روابط الكاميرا، قاعدة البيانات، مفتاح التشفير، S3
```

5. تشغيل الخلفية والعامل:

```bash
# تشغيل API
uvicorn visionguard.api:app --reload --host 0.0.0.0 --port 8000

# تشغيل عامل الكشف
python -m visionguard.worker.detector_worker --config config/dev.yaml
```

6. فتح لوحة التحكم:

- زر `http://localhost:3000` (أو المنفذ المكون) لعرض التنبيهات والتأكيد/الرفض.

---

## التكوين / متغيرات البيئة

احفظ الأسرار في `.env` (لا تحفظ أبداً المفاتيح):

```
DATABASE_URL=postgresql://user:pass@localhost:5432/visionguard
S3_ENDPOINT=http://localhost:9000
S3_BUCKET=visionguard-evidence
S3_ACCESS_KEY=MINIO_ACCESS_KEY
S3_SECRET_KEY=MINIO_SECRET_KEY

ENCRYPTION_KEY=base64:...   # مفتاح Fernet / AES، احتفظ به آمناً
ALERT_CALLBACK_WEBHOOK=https://example.com/alert
ADMIN_EMAIL=security@site.example
RETENTION_DAYS=30
```

مثال `config/dev.yaml`:

```yaml
cameras:
  - id: cam-entrance
    name: "ردهة المدخل"
    rtsp: "rtsp://user:pass@192.168.1.10/stream"
detector:
  model_path: "models/yolov8n.pt"
  min_confidence: 0.4
  temporal_frames: 5
evidence:
  pre_seconds: 3
  post_seconds: 2
  blur_faces: true
  encrypt: true
```

---

## أمثلة الاستخدام (APIs وسطر الأوامر)

### عامل الكشف

```bash
python -m visionguard.worker.detector_worker --config config/dev.yaml
```

### نقاط النهاية الخلفية (FastAPI)

- `POST /api/alerts/confirm` — المشغل يؤكد التنبيه.
- `POST /api/alerts/reject` — المشغل يرفض التنبيه.
- `GET  /api/alerts` — قائمة التنبيهات المعلقة.
- `GET  /api/evidence/{id}` — تنزيل الأدلة المشفرة (مخول).

### مثال على إدخال تنبيه في قاعدة البيانات

```json
{
  "id": "alert_001",
  "camera_id": "cam-entrance",
  "time": "2025-10-01T11:00:00Z",
  "type": "weapon",
  "confidence": 0.87,
  "evidence_path": "s3://visionguard-evidence/alert_20251001_001.enc",
  "status": "pending"
}
```

---

## تخزين البيانات والخصوصية

- **تشويش الوجوه:** تتم معالجة جميع اللقطات والمقاطع المخزنة بتشويش الوجوه افتراضياً لتجنب التعريف البيومتري.
- **التشفير:** ملفات الأدلة مشفرة أثناء التخزين (AES / Fernet) ومنقولة عبر HTTPS.
- **الاحتفاظ:** افتراضياً `RETENTION_DAYS=30`. تُحذف الأدلة بعد فترة الاحتفاظ ما لم تُعلم للاحتفاظ القانوني.
- **التحكم في الوصول والتدقيق:** وصول لوحة التحكم يتطلب حسابات مصادق عليها مع RBAC. كل وصول للأدلة مسجل.
- **لا مطابقة بيومترية:** VisionGuard **لا** يؤدي التعرف على الوجوه أو ربط الهوية عبر الكاميرات. أي طلب لإضافة التعريف يتطلب مراجعة قانونية.

---

## التقييم والمقاييس

راقب واضبط:

- الدقة، الاستدعاء، F1 لكل فئة (سلاح، قناع، قتال).
- معدل الإنذار الخاطئ (إنذارات/ساعة).
- زمن استجابة الكشف (ميلي ثانية).
- متوسط وقت التأكيد (استجابة المشغل).
- استخدام التخزين وامتثال الاحتفاظ.

اجمع مقاطع التحقق من كاميرات شبيهة بالنشر للضبط الدقيق.

---

## النشر

- **صغير المقياس:** عمال على أجهزة الحافة (Jetson) + خادم خلفي.
- **قابل للتوسيع:** Kubernetes للعمال، مخزن كائنات مدار للمقاطع.
- **قائمة تحقق الأمان:** مدير الأسرار (Vault/AWS Secrets)، TLS في كل مكان، صور محصنة، نسخ احتياطية لقاعدة البيانات والبيانات الوصفية.

---

## المساهمة

1. نسخ المستودع.
2. إنشاء فرع `feat/your-feature`.
3. إضافة اختبارات للكشف أو سلوك API.
4. إرسال PR مع وصف وخطوات الاختبار.
5. لا تتضمن الأسرار في الالتزامات.

---

## إشعار قانوني وأخلاقي

**مهم:** VisionGuard يتجنب عمداً التعريف البيومتري لتقليل مخاطر الخصوصية. قبل النشر:

- تحقق من الامتثال للقوانين المحلية/الإقليمية (مثل GDPR في الاتحاد الأوروبي).
- ضع لافتات CCTV مرئية حيث مطلوب.
- ضع سياسات احتفاظ ووصول معتمدة من المستشار القانوني.
- درب المشغلين على سير العمل المحافظ على الخصوصية.
- استشر المستشار القانوني قبل التكامل مع إنفاذ القانون أو سير عمل التعريف.

مؤلفو المشروع غير مسؤولين عن سوء الاستخدام. استخدم VisionGuard بشكل أخلاقي وقانوني.

---

## الترخيص والاتصال

- **الترخيص:** MIT (أو اختر الترخيص المناسب لمؤسستك)
- **المشرف / الاتصال:** security-team@example.com

---

### الخطوات التالية التي يمكنني تقديمها (اختر واحدة)

- إنشاء ملف `README.md` قابل للتنزيل وإعطاؤه هنا.
- توليد `docker-compose.yml`، `requirements.txt`، وهيكل FastAPI أدنى.
- إنشاء هيكل لوحة تحكم React للمبتدئين.
- توفير مثال على نص عامل الكشف جاهز للتشغيل مع كاميرا/فيديو عينة.
